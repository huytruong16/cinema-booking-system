generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model PHIM {
  MaPhim           String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenGoc           String          @unique
  TenHienThi       String          @unique
  TomTatNoiDung    String?
  DaoDien          String?
  DanhSachDienVien String?
  QuocGia          String?
  TrailerUrl       String?
  PosterUrl        String?
  BackdropUrl      String?
  ThoiLuong        Int
  NgayBatDauChieu  DateTime        @db.Timestamptz(6)
  NgayKetThucChieu DateTime        @db.Timestamptz(6)
  DiemDanhGia      Float?          @default(0.0) @db.Real
  TrangThaiPhim    trang_thai_phim @default(SAPCHIEU)
  MaNhanPhim       String?         @db.Uuid
  NhanPhim         NHANPHIM?       @relation(fields: [MaNhanPhim], references: [MaNhanPhim])
  DanhGias         DANHGIA[]
  PhienBanPhims    PHIENBANPHIM[]
  PhimTheLoais     PHIM_THELOAI[]
  CreatedAt        DateTime        @default(now()) @db.Timestamptz(6)
  UpdatedAt        DateTime        @default(now()) @db.Timestamptz(6)
  DeletedAt        DateTime?       @db.Timestamptz(6)
}

model NHANPHIM {
  MaNhanPhim  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenNhanPhim String    @unique
  MoTa        String?
  DoTuoiToiThieu Int?
  Phims       PHIM[]
  CreatedAt   DateTime  @default(now()) @db.Timestamptz(6)
  UpdatedAt   DateTime  @default(now()) @db.Timestamptz(6)
  DeletedAt   DateTime? @db.Timestamptz(6)
}

model NGONNGU {
  MaNgonNgu      String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenNgonNgu     String          @unique
  PhienBanPhims  PHIENBANPHIM[]
  CreatedAt      DateTime        @default(now()) @db.Timestamptz(6)
  UpdatedAt      DateTime        @default(now()) @db.Timestamptz(6)
  DeletedAt      DateTime?       @db.Timestamptz(6)
}

model THELOAI {
  MaTheLoai    String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenTheLoai   String         @unique
  PhimTheLoais PHIM_THELOAI[]
  CreatedAt    DateTime       @default(now()) @db.Timestamptz(6)
  UpdatedAt    DateTime       @default(now()) @db.Timestamptz(6)
  DeletedAt    DateTime?      @db.Timestamptz(6)
}

model PHIM_THELOAI {
  MaTheLoaiPhim String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaPhim        String    @db.Uuid
  MaTheLoai     String    @db.Uuid
  Phim          PHIM      @relation(fields: [MaPhim], references: [MaPhim])
  TheLoai       THELOAI   @relation(fields: [MaTheLoai], references: [MaTheLoai])
  CreatedAt     DateTime  @default(now()) @db.Timestamptz(6)
  UpdatedAt     DateTime  @default(now()) @db.Timestamptz(6)
  DeletedAt     DateTime? @db.Timestamptz(6)
}

model DINHDANG {
  MaDinhDang    String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenDinhDang   String          @unique
  GiaVe         Decimal
  PhienBanPhims PHIENBANPHIM[]
  CreatedAt     DateTime        @default(now()) @db.Timestamptz(6)
  UpdatedAt     DateTime        @default(now()) @db.Timestamptz(6)
  DeletedAt     DateTime?       @db.Timestamptz(6)
}

model PHIENBANPHIM {
  MaPhienBanPhim String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaPhim         String         @db.Uuid
  MaDinhDang     String         @db.Uuid
  MaNgonNgu      String         @db.Uuid
  GiaVe          Decimal
  Phim           PHIM           @relation(fields: [MaPhim], references: [MaPhim])
  DinhDang       DINHDANG       @relation(fields: [MaDinhDang], references: [MaDinhDang])
  NgonNgu        NGONNGU?       @relation(fields: [MaNgonNgu], references: [MaNgonNgu])
  SuatChieus     SUATCHIEU[]
  CreatedAt      DateTime       @default(now()) @db.Timestamptz(6)
  UpdatedAt      DateTime       @default(now()) @db.Timestamptz(6)
  DeletedAt      DateTime?      @db.Timestamptz(6)
}

model PHONGCHIEU {
  MaPhongChieu   String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenPhongChieu  String                  @unique
  SoDoGhe        Json
  TrangThai      trang_thai_phong_chieu  @default(TRONG)
  GhePhongChieus GHE_PHONGCHIEU[]
  SuatChieus     SUATCHIEU[]
  CreatedAt      DateTime                @default(now()) @db.Timestamptz(6)
  UpdatedAt      DateTime                @default(now()) @db.Timestamptz(6)
  DeletedAt      DateTime?               @db.Timestamptz(6)
}

model LOAIGHE {
  MaLoaiGhe  String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  LoaiGhe    String
  HeSoGiaGhe Float          @default(1.0) @db.Real
  GheLoaiGhes GHE_LOAIGHE[]
  CreatedAt  DateTime       @default(now()) @db.Timestamptz(6)
  UpdatedAt  DateTime       @default(now()) @db.Timestamptz(6)
  DeletedAt  DateTime?      @db.Timestamptz(6)
}

model GHE {
  MaGhe         String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  Hang          String         
  Cot           String
  GheLoaiGhes   GHE_LOAIGHE[]
  CreatedAt     DateTime         @default(now()) @db.Timestamptz(6)
  UpdatedAt     DateTime         @default(now()) @db.Timestamptz(6)
  DeletedAt     DateTime?        @db.Timestamptz(6)
}

model GHE_LOAIGHE {
  MaGheLoaiGhe   String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaGhe          String           @db.Uuid
  MaLoaiGhe      String           @db.Uuid
  Ghe            GHE              @relation(fields: [MaGhe], references: [MaGhe])
  LoaiGhe        LOAIGHE          @relation(fields: [MaLoaiGhe], references: [MaLoaiGhe])
  GhePhongChieus GHE_PHONGCHIEU[]
  CreatedAt      DateTime         @default(now()) @db.Timestamptz(6)
  UpdatedAt      DateTime         @default(now()) @db.Timestamptz(6)
  DeletedAt      DateTime?        @db.Timestamptz(6)
}

model GHE_PHONGCHIEU {
  MaGhePhongChieu String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaGheLoaiGhe    String          @db.Uuid
  MaPhongChieu    String          @db.Uuid
  GheLoaiGhe      GHE_LOAIGHE     @relation(fields: [MaGheLoaiGhe], references: [MaGheLoaiGhe])
  PhongChieu      PHONGCHIEU      @relation(fields: [MaPhongChieu], references: [MaPhongChieu])
  GheSuatChieus   GHE_SUATCHIEU[]
  CreatedAt       DateTime        @default(now()) @db.Timestamptz(6)
  UpdatedAt       DateTime        @default(now()) @db.Timestamptz(6)
  DeletedAt       DateTime?       @db.Timestamptz(6)
}

model SUATCHIEU {
  MaSuatChieu     String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaPhienBanPhim  String                @db.Uuid
  MaPhongChieu    String                @db.Uuid
  ThoiGianBatDau  DateTime              @db.Timestamptz(6)
  ThoiGianKetThuc DateTime              @db.Timestamptz(6)
  TrangThai       trang_thai_suat_chieu @default(CHUACHIEU)
  GheSuatChieus   GHE_SUATCHIEU[]
  PhienBanPhim    PHIENBANPHIM          @relation(fields: [MaPhienBanPhim], references: [MaPhienBanPhim])
  PhongChieu      PHONGCHIEU            @relation(fields: [MaPhongChieu], references: [MaPhongChieu])
  CreatedAt       DateTime              @default(now()) @db.Timestamptz(6)
  UpdatedAt       DateTime              @default(now()) @db.Timestamptz(6)
  DeletedAt       DateTime?             @db.Timestamptz(6)
}

model GHE_SUATCHIEU {
  MaGheSuatChieu  String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaGhePhongChieu String         @db.Uuid
  MaSuatChieu     String         @db.Uuid
  TrangThai       trang_thai_ghe @default(CONTRONG)
  GhePhongChieu   GHE_PHONGCHIEU  @relation(fields: [MaGhePhongChieu], references: [MaGhePhongChieu])
  SuatChieu       SUATCHIEU      @relation(fields: [MaSuatChieu], references: [MaSuatChieu])
  Ves             VE[]
  CreatedAt       DateTime       @default(now()) @db.Timestamptz(6)
  UpdatedAt       DateTime       @default(now()) @db.Timestamptz(6)
  DeletedAt       DateTime?      @db.Timestamptz(6)
}

model KHACHHANG {
  MaKhachHang      String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaNguoiDung      String                @db.Uuid
  HoaDons          HOADON[]
  NguoiDungPhanMem NGUOIDUNGPHANMEM      @relation(fields: [MaNguoiDung], references: [MaNguoiDung])
  KhuyenMaiKhachHangs KHUYENMAI_KHACHHANG[]
  CreatedAt        DateTime              @default(now()) @db.Timestamptz(6)
  UpdatedAt        DateTime              @default(now()) @db.Timestamptz(6)
  DeletedAt        DateTime?             @db.Timestamptz(6)
}

model VE {
  MaVe           String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaGheSuatChieu String          @db.Uuid
  GiaVe          Decimal
  MaHoaDon       String          @db.Uuid
  TrangThaiVe    trang_thai_ve   @default(CHUASUDUNG)
  GheSuatChieu   GHE_SUATCHIEU    @relation(fields: [MaGheSuatChieu], references: [MaGheSuatChieu])
  HoaDon         HOADON          @relation(fields: [MaHoaDon], references: [MaHoaDon])
  YeuCauHoanVes  YEUCAUHOANVE[]
  CreatedAt      DateTime        @default(now()) @db.Timestamptz(6)
  UpdatedAt      DateTime        @default(now()) @db.Timestamptz(6)
  DeletedAt      DateTime?       @db.Timestamptz(6)
}

model YEUCAUHOANVE {
  MaYeuCau     String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaVe         String                 @db.Uuid
  MaGiaoDich   String?                @db.Uuid
  TrangThai    trang_thai_yeu_cau     @default(DANGCHO)
  Ve           VE                     @relation(fields: [MaVe], references: [MaVe])
  GiaoDich     GIAODICH?              @relation(fields: [MaGiaoDich], references: [MaGiaoDich])
  CreatedAt    DateTime               @default(now()) @db.Timestamptz(6)
  UpdatedAt    DateTime               @default(now()) @db.Timestamptz(6)
  DeletedAt    DateTime?              @db.Timestamptz(6)
}

model COMBO {
  MaCombo      String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenCombo     String           @unique
  MoTa         String?
  GiaTien      Decimal
  TrangThai    trang_thai_combo @default(CONHANG)
  HinhAnh      String?
  HoaDonCombos HOADONCOMBO[]
  CreatedAt    DateTime         @default(now()) @db.Timestamptz(6)
  UpdatedAt    DateTime         @default(now()) @db.Timestamptz(6)
  DeletedAt    DateTime?        @db.Timestamptz(6)
}

model HOADONCOMBO {
  MaVeCombo String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaHoaDon  String     @db.Uuid
  MaCombo   String     @db.Uuid
  SoLuong   Int        @default(1)
  DonGia    Decimal  
  Combo     COMBO      @relation(fields: [MaCombo], references: [MaCombo])
  HoaDon    HOADON     @relation(fields: [MaHoaDon], references: [MaHoaDon])
  CreatedAt DateTime   @default(now()) @db.Timestamptz(6)
  UpdatedAt DateTime   @default(now()) @db.Timestamptz(6)
  DeletedAt DateTime?  @db.Timestamptz(6)
}

model HOADON {
  MaHoaDon     String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  Email        String
  Code         String         @unique
  NgayLap      DateTime       @db.Timestamptz(6)
  MaKhachHang  String?        @db.Uuid
  TongTien     Decimal
  KhachHang    KHACHHANG?     @relation(fields: [MaKhachHang], references: [MaKhachHang])
  HoaDonCombos HOADONCOMBO[]
  GiaoDichs    GIAODICH[]
  Ves          VE[]
  HoaDonKhuyenMais HOADON_KHUYENMAI[]
  CreatedAt    DateTime       @default(now()) @db.Timestamptz(6)
  UpdatedAt    DateTime       @default(now()) @db.Timestamptz(6)
  DeletedAt    DateTime?      @db.Timestamptz(6)
}

model KHUYENMAI {
  MaKhuyenMai       String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenKhuyenMai      String
  MoTa              String?
  Code              String                @unique
  LoaiGiamGia       loai_giam_gia
  GiaTri            Decimal
  NgayBatDau        DateTime              @db.Timestamptz(6)
  NgayKetThuc       DateTime              @db.Timestamptz(6)
  SoLuongMa         Int
  SoLuongSuDung     Int                   @default(0)
  GiaTriDonToiThieu Decimal
  GiaTriGiamToiDa   Decimal
  TrangThai         trang_thai_khuyen_mai @default(CONHOATDONG)
  DoiTuongApDung    doi_tuong_ap_dung_km
  KhuyenMaiKhachHangs KHUYENMAI_KHACHHANG[]
  CreatedAt         DateTime              @default(now()) @db.Timestamptz(6)
  UpdatedAt         DateTime              @default(now()) @db.Timestamptz(6)
  DeletedAt         DateTime?             @db.Timestamptz(6)
}

model HOADON_KHUYENMAI {
  MaHoaDonKM       String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaHoaDon         String    @db.Uuid
  MaKhuyenMaiKH    String    @db.Uuid
  GiaTriGiam       Decimal
  CreatedAt        DateTime  @default(now()) @db.Timestamptz(6)
  UpdatedAt        DateTime  @default(now()) @db.Timestamptz(6)
  DeletedAt        DateTime? @db.Timestamptz(6)
  HoaDon           HOADON    @relation(fields: [MaHoaDon], references: [MaHoaDon])
  KhuyenMaiKH      KHUYENMAI_KHACHHANG @relation(fields: [MaKhuyenMaiKH], references: [MaKhuyenMaiKH])
}

model KHUYENMAI_KHACHHANG {
  MaKhuyenMaiKH String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaKhuyenMai   String      @db.Uuid
  MaKhachHang   String      @db.Uuid
  DaSuDung      Boolean     @default(false)
  KhachHang     KHACHHANG   @relation(fields: [MaKhachHang], references: [MaKhachHang])
  KhuyenMai     KHUYENMAI   @relation(fields: [MaKhuyenMai], references: [MaKhuyenMai])
  HoaDonKhuyenMais HOADON_KHUYENMAI[]
  CreatedAt     DateTime    @default(now()) @db.Timestamptz(6)
  UpdatedAt     DateTime    @default(now()) @db.Timestamptz(6)
  DeletedAt     DateTime?   @db.Timestamptz(6)
}

model GIAODICH {
  MaGiaoDich    String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaNhanVien    String?                @db.Uuid
  MaHoaDon      String                 @db.Uuid
  PhuongThuc    phuong_thuc_thanh_toan
  TongTien      Decimal
  TrangThai     trang_thai_thanh_toan  @default(DANGCHO)
  NgayGiaoDich  DateTime               @db.Timestamptz(6)
  NoiDung       String?
  LoaiGiaoDich  loai_giao_dich
  Code          String
  LinkId        String                 
  GiaoDichUrl   String
  HoaDon        HOADON                 @relation(fields: [MaHoaDon], references: [MaHoaDon])
  NhanVien      NHANVIEN?              @relation(fields: [MaNhanVien], references: [MaNhanVien])
  YeuCauHoanVes YEUCAUHOANVE[]
  CreatedAt     DateTime               @default(now()) @db.Timestamptz(6)
  UpdatedAt     DateTime               @default(now()) @db.Timestamptz(6)
  DeletedAt     DateTime?              @db.Timestamptz(6)
}

model NHANVIEN {
  MaNhanVien       String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  NgayVaoLam       DateTime             @db.Timestamptz(6)
  TrangThai        trang_thai_nhan_vien @default(CONLAM)
  MaNguoiDung      String @db.Uuid
  NguoiDungPhanMem NGUOIDUNGPHANMEM     @relation(fields: [MaNguoiDung], references: [MaNguoiDung])
  GiaoDichs        GIAODICH[]
  CreatedAt        DateTime             @default(now()) @db.Timestamptz(6)
  UpdatedAt        DateTime             @default(now()) @db.Timestamptz(6)
  DeletedAt        DateTime?            @db.Timestamptz(6)
}

model NGUOIDUNGPHANMEM {
  MaNguoiDung     String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  HoTen           String
  MatKhau         String
  SoDienThoai     String?
  Email           String                @unique
  AvatarUrl       String?
  MaNhomNguoiDung String? @db.Uuid
  TrangThai       trang_thai_nguoi_dung @default(CHUAKICHHOAT)
  VaiTro          vaitro                @default(KHACHHANG)
  KhachHangs      KHACHHANG[]
  NhomNguoiDung   NHOMNGUOIDUNG?        @relation(fields: [MaNhomNguoiDung], references: [MaNhomNguoiDung])
  NhanViens       NHANVIEN[]
  CreatedAt       DateTime              @default(now()) @db.Timestamptz(6)
  UpdatedAt       DateTime              @default(now()) @db.Timestamptz(6)
  DeletedAt       DateTime?             @db.Timestamptz(6)
}

model NHOMNGUOIDUNG {
  MaNhomNguoiDung  String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenNhomNguoiDung String                @unique
  NguoiDungPhanMems NGUOIDUNGPHANMEM[]
  QuyenNhomNguoiDungs QUYEN_NHOMNGUOIDUNG[]
  CreatedAt        DateTime              @default(now()) @db.Timestamptz(6)
  UpdatedAt        DateTime              @default(now()) @db.Timestamptz(6)
  DeletedAt        DateTime?             @db.Timestamptz(6)
}

model QUYEN_NHOMNGUOIDUNG {
  MaQuyenNhomNguoiDung String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaNhomNguoiDung      String        @db.Uuid
  Quyen                quyen
  NhomNguoiDung        NHOMNGUOIDUNG @relation(fields: [MaNhomNguoiDung], references: [MaNhomNguoiDung])
  CreatedAt            DateTime      @default(now()) @db.Timestamptz(6)
  UpdatedAt            DateTime      @default(now()) @db.Timestamptz(6)
  DeletedAt            DateTime?     @db.Timestamptz(6)
}

model DANHGIA {
  MaDanhGia  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  NoiDung    String
  Diem       Float     @db.Real
  MaPhim     String?   @db.Uuid
  Phim       PHIM?     @relation(fields: [MaPhim], references: [MaPhim], onDelete: NoAction, onUpdate: NoAction)
  CreatedAt  DateTime  @default(now()) @db.Timestamptz(6)
  UpdatedAt  DateTime  @default(now()) @db.Timestamptz(6)
  DeletedAt  DateTime? @db.Timestamptz(6)
}

model THAMSO {
  MaThamSo       String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenThamSo      String    
  GiaTri         String
  KieuDuLieu     String
  CreatedAt      DateTime  @default(now()) @db.Timestamptz(6)
  UpdatedAt      DateTime  @default(now()) @db.Timestamptz(6)
  DeletedAt      DateTime? @db.Timestamptz(6)
}

model BAOCAODOANHTHU {
  MaBCDoanhThu   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  Ngay           DateTime  @unique @default(now()) @db.Timestamptz(6)
  DoanhThuVe     Decimal   
  DoanhThuCombo  Decimal
  CreatedAt      DateTime  @default(now()) @db.Timestamptz(6)
  UpdatedAt      DateTime  @default(now()) @db.Timestamptz(6)
  DeletedAt      DateTime? @db.Timestamptz(6)
}

enum trang_thai_phim {
  SAPCHIEU
  DANGCHIEU
  NGUNGCHIEU
}

enum trang_thai_suat_chieu {
  CHUACHIEU
  SAPCHIEU
  DANGCHIEU
  DACHIEU
  DAHUY
}

enum trang_thai_phong_chieu {
  TRONG
  SAPCHIEU
  DANGCHIEU
}

enum trang_thai_ghe {
  CONTRONG
  DADAT
  DANGGIU
}

enum trang_thai_ve {
  CHUASUDUNG
  DASUDUNG
  DAHETHAN
  CHUAHOANTIEN
  CHOHOANTIEN
  DAHOAN
}

enum trang_thai_combo {
  CONHANG
  HETHANG
}

enum phuong_thuc_thanh_toan {
  TRUCTIEP
  TRUCTUYEN
}

enum loai_giam_gia {
  CODINH
  PHANTRAM
}

enum trang_thai_khuyen_mai {
  CONHOATDONG
  KHONGCONHOATDONG
}

enum trang_thai_thanh_toan {
  DANGCHO
  THANHCONG
  THATBAI
}

enum loai_giao_dich {
  MUAVE
  HOANTIEN
}

enum trang_thai_yeu_cau {
  DANGCHO
  DAHOAN
}

enum trang_thai_nhan_vien {
  CONLAM
  DANGHI
}

enum trang_thai_nguoi_dung {
  CHUAKICHHOAT
  CONHOATDONG
  KHONGHOATDONG
}

enum quyen {
  BANVE
  HOANVE
  YEUCAUHOANVE
  SOATVE
  BAOCAODOANHTHU
  QLPHIM
  QLLICHCHIEU
  QLPHONGCHIEU
  QLSUATCHIEU
  QLGHE
  MUAVE
}

enum vaitro {
  KHACHHANG
  NHANVIEN
  ADMIN
}

enum doi_tuong_ap_dung_km {
  VE
  COMBO
}