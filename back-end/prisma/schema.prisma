generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model PHIM {
  MaPhim           String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenGoc           String          @unique
  TenHienThi       String          @unique
  TomTatNoiDung    String?
  DaoDien          String?
  DanhSachDienVien String?
  QuocGia          String?
  TrailerUrl       String?
  PosterUrl        String?
  ThoiLuong        Int
  NgayBatDauChieu  DateTime
  NgayKetThucChieu DateTime
  DiemDanhGia      Decimal?        @default(0.0)
  TrangThaiPhim    trang_thai_phim @default(SAPCHIEU)
  DanhGias         DANHGIA[]
  DinhDangs        PHIM_DINHDANG[]
  TheLoais         PHIM_THELOAI[]
  CreatedAt        DateTime @default(now()) 
  UpdatedAt        DateTime @default(now())
  DeletedAt        DateTime?
}

model THELOAI {
  MaTheLoai    String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenTheLoai   String         @unique
  PhimTheLoais PHIM_THELOAI[]
  CreatedAt    DateTime       @default(now()) 
  UpdatedAt    DateTime       @default(now())
  DeletedAt    DateTime?
}

model PHIM_THELOAI {
  MaTheLoaiPhim String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaPhim        String    @db.Uuid
  MaTheLoai     String    @db.Uuid
  PHIM          PHIM      @relation(fields: [MaPhim], references: [MaPhim])
  THELOAI       THELOAI   @relation(fields: [MaTheLoai], references: [MaTheLoai])
  CreatedAt     DateTime  @default(now())
  UpdatedAt     DateTime  @default(now())
  DeletedAt     DateTime?
}

model DINHDANG {
  MaDinhDang    String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenDinhDang   String          @unique
  GiaVe         Decimal
  PhimDinhDangs PHIM_DINHDANG[]
  CreatedAt     DateTime        @default(now())
  UpdatedAt     DateTime        @default(now())
  DeletedAt     DateTime?
}

model PHIM_DINHDANG {
  MaPhimDinhDang String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaPhim         String      @db.Uuid
  MaDinhDang     String      @db.Uuid
  GiaVe          Decimal
  DINHDANG       DINHDANG    @relation(fields: [MaDinhDang], references: [MaDinhDang])
  PHIM           PHIM        @relation(fields: [MaPhim], references: [MaPhim])
  SuatChieus     SUATCHIEU[]
  CreatedAt      DateTime    @default(now())
  UpdatedAt      DateTime    @default(now())
  DeletedAt      DateTime?
}

model PHONGCHIEU {
  MaPhongChieu  String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenPhongChieu String           @unique
  SoDoGhe       Json
  GhePhongChieu GHE_PHONGCHIEU[]
  SuatChieus    SUATCHIEU[]
  CreatedAt     DateTime         @default(now())
  UpdatedAt     DateTime         @default(now())
  DeletedAt     DateTime?
}

model LOAIGHE {
  MaLoaiGhe  String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  LoaiGhe    String
  HeSoGiaGhe Decimal    @default(1.0)
  Ghes       GHE[]
  CreatedAt  DateTime   @default(now())
  UpdatedAt  DateTime   @default(now())
  DeletedAt  DateTime?
}

model GHE {
  MaGhe         String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  SoGhe         String
  MaLoaiGhe     String           @db.Uuid
  LOAIGHE       LOAIGHE          @relation(fields: [MaLoaiGhe], references: [MaLoaiGhe])
  GhePhongChieu GHE_PHONGCHIEU[]
  CreatedAt     DateTime         @default(now())
  UpdatedAt     DateTime         @default(now())
  DeletedAt     DateTime?
}

model GHE_PHONGCHIEU {
  MaGhePhongChieu String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaGhe           String          @db.Uuid
  MaPhongChieu    String          @db.Uuid
  GHE             GHE             @relation(fields: [MaGhe], references: [MaGhe])
  PHONGCHIEU      PHONGCHIEU      @relation(fields: [MaPhongChieu], references: [MaPhongChieu])
  GheSuatChieu    GHE_SUATCHIEU[]
  CreatedAt       DateTime        @default(now())
  UpdatedAt       DateTime        @default(now())
  DeletedAt       DateTime?
}

model SUATCHIEU {
  MaSuatChieu     String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaPhimDinhDang  String @db.Uuid
  MaPhongChieu    String @db.Uuid
  ThoiGianBatDau  DateTime
  ThoiGianKetThuc DateTime
  TrangThai       trang_thai_suat_chieu @default(CHUACHIEU)
  GheSuatChieu    GHE_SUATCHIEU[]
  PHIM_DINHDANG   PHIM_DINHDANG         @relation(fields: [MaPhimDinhDang], references: [MaPhimDinhDang])
  PHONGCHIEU      PHONGCHIEU            @relation(fields: [MaPhongChieu], references: [MaPhongChieu])
  CreatedAt       DateTime              @default(now())
  UpdatedAt       DateTime              @default(now())
  DeletedAt       DateTime?
}

model GHE_SUATCHIEU {
  MaGheSuatChieu  String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaGhePhongChieu String         @db.Uuid
  MaSuatChieu     String         @db.Uuid
  TrangThai       trang_thai_ghe @default(CONTRONG)
  GHE_PHONGCHIEU  GHE_PHONGCHIEU @relation(fields: [MaGhePhongChieu], references: [MaGhePhongChieu])
  SUATCHIEU       SUATCHIEU      @relation(fields: [MaSuatChieu], references: [MaSuatChieu])
  Ves             VE[]
  CreatedAt       DateTime       @default(now())
  UpdatedAt       DateTime       @default(now())
  DeletedAt       DateTime?
}

model KHACHHANG {
  MaKhachHang      String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaNguoiDung      String                @db.Uuid
  HoaDons          HOADON[]
  NGUOIDUNGPHANMEM NGUOIDUNGPHANMEM      @relation(fields: [MaNguoiDung], references: [MaNguoiDung])
  KhuyenMais       KHUYENMAI_KHACHHANG[]
  CreatedAt        DateTime              @default(now())
  UpdatedAt        DateTime              @default(now())
  DeletedAt        DateTime?
}

model VE {
  MaVe           String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaGheSuatChieu String        @db.Uuid
  GiaVe          Decimal
  MaHoaDon       String        @db.Uuid
  TrangThaiVe    trang_thai_ve @default(CHUASUDUNG)
  GHE_SUATCHIEU  GHE_SUATCHIEU @relation(fields: [MaGheSuatChieu], references: [MaGheSuatChieu])
  HOADON         HOADON        @relation(fields: [MaHoaDon], references: [MaHoaDon])
  CreatedAt      DateTime      @default(now())
  UpdatedAt      DateTime      @default(now())
  DeletedAt      DateTime?
}

model COMBO {
  MaCombo     String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenCombo    String           @unique
  MoTa        String?
  GiaTien     Decimal
  TrangThai   trang_thai_combo @default(CONHANG)
  HinhAnh     String?
  HoaDonCombo HOADONCOMBO[]
  CreatedAt   DateTime         @default(now())
  UpdatedAt   DateTime         @default(now())
  DeletedAt   DateTime?
}

model HOADONCOMBO {
  MaVeCombo String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaHoaDon  String     @db.Uuid
  MaCombo   String     @db.Uuid
  SoLuong   Int        @default(1)
  DonGia    Decimal  
  COMBO     COMBO      @relation(fields: [MaCombo], references: [MaCombo])
  HOADON    HOADON     @relation(fields: [MaHoaDon], references: [MaHoaDon])
  CreatedAt DateTime   @default(now())
  UpdatedAt DateTime   @default(now())
  DeletedAt DateTime?
}

model HOADON {
  MaHoaDon    String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  Email       String
  Code        String         @unique
  NgayLap     DateTime
  MaKhachHang String?        @db.Uuid
  TongTien    Decimal
  KHACHHANG   KHACHHANG?     @relation(fields: [MaKhachHang], references: [MaKhachHang])
  HoaDonCombo HOADONCOMBO[]
  GiaoDich    GIAODICH[]
  Ves         VE[]
  CreatedAt   DateTime       @default(now())
  UpdatedAt   DateTime       @default(now())
  DeletedAt   DateTime?
}

model KHUYENMAI {
  MaKhuyenMai       String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenKhuyenMai      String
  MoTa              String?
  Code              String                @unique
  LoaiGiamGia       loai_giam_gia
  GiaTri            Decimal
  NgayBatDau        DateTime
  NgayKetThuc       DateTime
  SoLuongMa         Int
  SoLuongSuDung     Int                   @default(0)
  GiaTriDonToiThieu Decimal
  GiaTriGiamToiDa   Decimal
  TrangThai         trang_thai_khuyen_mai @default(CONHOATDONG)
  KhuyenMaiKH       KHUYENMAI_KHACHHANG[]
  CreatedAt         DateTime              @default(now())
  UpdatedAt         DateTime              @default(now())
  DeletedAt         DateTime?
}

model KHUYENMAI_KHACHHANG {
  MaKhuyenMaiKH String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaKhuyenMai   String      @db.Uuid
  MaKhachHang   String      @db.Uuid
  DaSuDung      Boolean     @default(false)
  KHACHHANG     KHACHHANG   @relation(fields: [MaKhachHang], references: [MaKhachHang])
  KHUYENMAI     KHUYENMAI   @relation(fields: [MaKhuyenMai], references: [MaKhuyenMai])
  CreatedAt     DateTime    @default(now())
  UpdatedAt     DateTime    @default(now())
  DeletedAt     DateTime?
}

model GIAODICH {
  MaGiaoDich    String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaNhanVien    String?                @db.Uuid
  MaHoaDon      String @db.Uuid
  PhuongThuc    phuong_thuc_thanh_toan
  TongTien      Decimal
  TrangThai     trang_thai_thanh_toan  @default(DANGCHO)
  NgayGiaoDich  DateTime
  NoiDung       String?
  LoaiGiaoDich  loai_giao_dich
  Code          String
  GiaoDichUrl   String
  HOADON        HOADON                 @relation(fields: [MaHoaDon], references: [MaHoaDon])
  NHANVIEN      NHANVIEN?              @relation(fields: [MaNhanVien], references: [MaNhanVien])
  CreatedAt     DateTime               @default(now())
  UpdatedAt     DateTime               @default(now())
  DeletedAt     DateTime?
}

model NHANVIEN {
  MaNhanVien       String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  NgayVaoLam       DateTime
  TrangThai        trang_thai_nhan_vien @default(CONLAM)
  MaNguoiDung      String @db.Uuid
  NGUOIDUNGPHANMEM NGUOIDUNGPHANMEM     @relation(fields: [MaNguoiDung], references: [MaNguoiDung])
  GiaoDichs        GIAODICH[]
  CreatedAt        DateTime             @default(now())
  UpdatedAt        DateTime             @default(now())
  DeletedAt        DateTime?
}

model NGUOIDUNGPHANMEM {
  MaNguoiDung     String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  HoTen           String
  MatKhau         String
  SoDienThoai     String?
  Email           String                @unique
  AvatarUrl       String?
  MaNhomNguoiDung String? @db.Uuid
  TrangThai       trang_thai_nguoi_dung @default(CHUAKICHHOAT)
  VaiTro          vaitro                @default(KHACHHANG)
  KhachHangs      KHACHHANG[]
  NHOMNGUOIDUNG   NHOMNGUOIDUNG?        @relation(fields: [MaNhomNguoiDung], references: [MaNhomNguoiDung])
  NhanViens       NHANVIEN[]
  CreatedAt       DateTime              @default(now())
  UpdatedAt       DateTime              @default(now())
  DeletedAt       DateTime?
}

model NHOMNGUOIDUNG {
  MaNhomNguoiDung  String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  TenNhomNguoiDung String                @unique
  NguoiDungs       NGUOIDUNGPHANMEM[]
  QuyenNhom        QUYEN_NHOMNGUOIDUNG[]
  CreatedAt        DateTime              @default(now())
  UpdatedAt        DateTime              @default(now())
  DeletedAt        DateTime?
}

model QUYEN_NHOMNGUOIDUNG {
  MaQuyenNhomNguoiDung String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  MaNhomNguoiDung      String        @db.Uuid
  Quyen                quyen
  NHOMNGUOIDUNG        NHOMNGUOIDUNG @relation(fields: [MaNhomNguoiDung], references: [MaNhomNguoiDung])
  CreatedAt            DateTime      @default(now())
  UpdatedAt            DateTime      @default(now())
  DeletedAt            DateTime?
}

model DANHGIA {
  MaDanhGia  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  NoiDung    String
  Diem       Decimal
  MaPhim     String?   @db.Uuid
  PHIM       PHIM?     @relation(fields: [MaPhim], references: [MaPhim], onDelete: NoAction, onUpdate: NoAction)
  CreatedAt  DateTime  @default(now()) @db.Timestamptz(6)
  UpdatedAt  DateTime  @default(now()) @db.Timestamp(6)
  DeletedAt  DateTime? @db.Timestamp(6)
}

enum trang_thai_phim {
  SAPCHIEU
  DANGCHIEU
  NGUNGCHIEU
}

enum trang_thai_suat_chieu {
  CHUACHIEU
  DANGCHIEU
  DACHIEU
  DAHUY
}

enum trang_thai_ghe {
  CONTRONG
  DADAT
  DANGGIU
  BAOTRI
}

enum trang_thai_ve {
  CHUASUDUNG
  DASUDUNG
  DAHETHAN
  CHUAHOANTIEN
  CHOHOANTIEN
  DAHOAN
}

enum trang_thai_combo {
  CONHANG
  HETHANG
}

enum phuong_thuc_thanh_toan {
  TRUCTIEP
  TRUCTUYEN
}

enum loai_giam_gia {
  CODINH
  PHANTRAM
}

enum trang_thai_khuyen_mai {
  CONHOATDONG
  KHONGCONHOATDONG
}

enum trang_thai_thanh_toan {
  DANGCHO
  THANHCONG
  THATBAI
}

enum loai_giao_dich {
  MUAVE
  HOANTIEN
}

enum trang_thai_nhan_vien {
  CONLAM
  DANGHI
}

enum trang_thai_nguoi_dung {
  CHUAKICHHOAT
  CONHOATDONG
  KHONGHOATDONG
}

enum quyen {
  BANVE
  HOANVE
  YEUCAUHOANVE
  SOATVE
  BAOCAODOANHTHU
  QLPHIM
  QLLICHCHIEU
  QLPHONGCHIEU
  QLSUATCHIEU
  QLGHE
  MUAVE
}

enum vaitro {
  KHACHHANG
  NHANVIEN
  ADMIN
}
